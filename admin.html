<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ì™„ë„ê³  í™˜ê²½ ì§€í‚´ì´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poor+Story&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Gaegu&display=swap");

      body {
        font-family: "Poor Story", "Gaegu", sans-serif;
        background-color: #f5f7f4;
        letter-spacing: -0.02em;
      }

      .title-font {
        font-family: "Gaegu", "Poor Story", sans-serif;
      }

      .eco-gradient {
        background: linear-gradient(120deg, #4ade80 0%, #60a5fa 100%);
      }
    </style>
  </head>
  <body class="bg-[#F5F7F4]">
    <!-- ìƒë‹¨ í—¤ë” -->
    <header
      class="bg-white/80 backdrop-blur-md shadow-sm fixed top-0 w-full z-10"
    >
      <div
        class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between"
      >
        <h1 class="text-2xl font-bold text-[#2F855A] title-font">
          ğŸŒ± ì™„ë„ê³  í™˜ê²½ ì§€í‚´ì´
        </h1>
        <div class="flex items-center space-x-4">
          <span class="text-[#2F855A] font-bold">ê´€ë¦¬ì ëª¨ë“œ</span>
          <button id="logoutBtn" class="text-[#2F855A]">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- ì‚¬ì´ë“œë°”ì™€ ë©”ì¸ ì»¨í…ì¸  -->
    <div class="flex min-h-screen pt-16">
      <!-- ì‚¬ì´ë“œë°” -->
      <div class="w-64 bg-white/80 backdrop-blur shadow-lg">
        <div class="p-4">
          <ul class="space-y-2">
            <li>
              <button
                id="dashboardBtn"
                class="w-full flex items-center px-4 py-3 text-[#2F855A] hover:bg-green-50 rounded-xl"
              >
                <i class="fas fa-chart-line mr-3"></i>
                ëŒ€ì‹œë³´ë“œ
              </button>
            </li>
            <li>
              <button
                id="activitiesBtn"
                class="w-full flex items-center px-4 py-2 text-gray-700 hover:bg-green-50 rounded-md"
              >
                <i class="fas fa-tasks mr-3"></i>
                í™œë™ ì¸ì¦ ê´€ë¦¬
              </button>
            </li>
            <li>
              <button
                id="usersBtn"
                class="w-full flex items-center px-4 py-2 text-gray-700 hover:bg-green-50 rounded-md"
              >
                <i class="fas fa-users mr-3"></i>
                ì‚¬ìš©ì ê´€ë¦¬
              </button>
            </li>
            <li>
              <button
                id="categoriesBtn"
                class="w-full flex items-center px-4 py-2 text-gray-700 hover:bg-green-50 rounded-md"
              >
                <i class="fas fa-list mr-3"></i>
                ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
              </button>
            </li>
            <li>
              <button
                id="tipsBtn"
                class="w-full flex items-center px-4 py-2 text-gray-700 hover:bg-green-50 rounded-md"
              >
                <i class="fas fa-lightbulb mr-3"></i>
                íŒ ê´€ë¦¬
              </button>
            </li>
          </ul>
        </div>
      </div>

      <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
      <div class="flex-1 p-8">
        <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
        <div id="dashboardSection" class="space-y-8">
          <h2 class="text-2xl font-bold text-[#2F855A] title-font">ëŒ€ì‹œë³´ë“œ</h2>

          <!-- í†µê³„ ì¹´ë“œë“¤ -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div
              class="bg-white/80 backdrop-blur p-6 rounded-3xl shadow-lg border border-green-100"
            >
              <h3 class="text-lg font-bold text-[#2F855A]">ì „ì²´ ì§„í–‰ë¥ </h3>
              <div class="mt-2">
                <div class="relative pt-1">
                  <div
                    class="overflow-hidden h-2 text-xs flex rounded bg-green-200"
                  >
                    <div
                      id="progressBar"
                      class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"
                      style="width: 0%"
                    ></div>
                  </div>
                </div>
                <p
                  id="progressText"
                  class="mt-2 text-2xl font-bold text-green-600"
                >
                  0%
                </p>
              </div>
            </div>

            <div
              class="bg-white/80 backdrop-blur p-6 rounded-3xl shadow-lg border border-green-100"
            >
              <h3 class="text-lg font-bold text-[#2F855A]">ëŒ€ê¸°ì¤‘ì¸ ì¸ì¦</h3>
              <p
                id="pendingCount"
                class="mt-2 text-2xl font-bold text-yellow-600"
              >
                0
              </p>
            </div>

            <div
              class="bg-white/80 backdrop-blur p-6 rounded-3xl shadow-lg border border-green-100"
            >
              <h3 class="text-lg font-bold text-[#2F855A]">ì „ì²´ ì‚¬ìš©ì</h3>
              <p id="userCount" class="mt-2 text-2xl font-bold text-blue-600">
                0
              </p>
            </div>

            <div
              class="bg-white/80 backdrop-blur p-6 rounded-3xl shadow-lg border border-green-100"
            >
              <h3 class="text-lg font-bold text-[#2F855A]">ì˜¤ëŠ˜ì˜ í™œë™</h3>
              <p
                id="todayActivities"
                class="mt-2 text-2xl font-bold text-purple-600"
              >
                0
              </p>
            </div>
          </div>

          <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ -->
          <div
            class="bg-white/80 backdrop-blur p-8 rounded-3xl shadow-lg border border-green-100"
          >
            <h3 class="text-xl font-bold text-[#2F855A]">ì¹´í…Œê³ ë¦¬ë³„ í†µê³„</h3>
            <div
              id="categoryStats"
              class="grid grid-cols-1 md:grid-cols-3 gap-4"
            >
              <!-- ì¹´í…Œê³ ë¦¬ í†µê³„ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <!-- í™œë™ ì¸ì¦ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="activitiesSection" class="hidden space-y-6">
          <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-[#2F855A] title-font">
              í™œë™ ì¸ì¦ ê´€ë¦¬
            </h2>
            <div class="flex space-x-4">
              <select id="statusFilter" class="rounded-lg border-gray-300">
                <option value="">ì „ì²´ ìƒíƒœ</option>
                <option value="pending">ëŒ€ê¸°ì¤‘</option>
                <option value="approved">ìŠ¹ì¸ë¨</option>
                <option value="rejected">ê±°ì ˆë¨</option>
              </select>
              <select id="categoryFilter" class="rounded-lg border-gray-300">
                <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
              </select>
            </div>
          </div>

          <div class="bg-white rounded-xl shadow-lg p-6">
            <div id="activitiesList" class="space-y-4">
              <!-- í™œë™ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
            <div
              id="activitiesPagination"
              class="mt-6 flex justify-center space-x-2"
            >
              <!-- í˜ì´ì§€ë„¤ì´ì…˜ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <!-- ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="usersSection" class="hidden space-y-6">
          <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-[#2F855A] title-font">
              ì‚¬ìš©ì ê´€ë¦¬
            </h2>
            <div class="flex space-x-4">
              <input
                type="text"
                id="userSearchInput"
                placeholder="í•™ë²ˆ ê²€ìƒ‰..."
                class="rounded-lg border-gray-300"
              />
            </div>
          </div>

          <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="overflow-x-auto">
              <table class="min-w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      í•™ë²ˆ
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ì´ë¦„
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ê°€ì…ì¼
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ê¶Œí•œ
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ê´€ë¦¬
                    </th>
                  </tr>
                </thead>
                <tbody id="usersList" class="bg-white divide-y divide-gray-200">
                  <!-- ì‚¬ìš©ì ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
            <div
              id="usersPagination"
              class="mt-6 flex justify-center space-x-2"
            >
              <!-- í˜ì´ì§€ë„¤ì´ì…˜ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="categoriesSection" class="hidden space-y-6">
          <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-[#2F855A] title-font">
              ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
            </h2>
            <button
              onclick="showAddCategoryModal()"
              class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
            >
              ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            </button>
          </div>

          <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="overflow-x-auto">
              <table class="min-w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ì½”ë“œ
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ì´ë¦„
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ì„¤ëª…
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ìˆœì„œ
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ìƒíƒœ
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ê´€ë¦¬
                    </th>
                  </tr>
                </thead>
                <tbody
                  id="categoriesList"
                  class="bg-white divide-y divide-gray-200"
                >
                  <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
        <div
          id="categoryModal"
          class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center"
        >
          <div class="bg-white rounded-lg p-8 max-w-md w-full">
            <h3 class="text-xl font-bold text-gray-900 mb-4" id="modalTitle">
              ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            </h3>
            <form id="categoryForm" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ì½”ë“œ</label
                >
                <input
                  type="text"
                  id="categoryCode"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"
                  required
                  pattern="[a-zA-Z0-9_-]+"
                  title="ì˜ë¬¸, ìˆ«ì, í•˜ì´í”ˆ(-), ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤"
                  placeholder="ì˜ˆ: eco_action"
                />
                <p class="mt-1 text-sm text-gray-500">
                  ì˜ë¬¸, ìˆ«ì, í•˜ì´í”ˆ(-), ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥
                </p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ì´ë¦„</label
                >
                <input
                  type="text"
                  id="categoryName"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"
                  required
                  maxlength="20"
                  placeholder="ì˜ˆ: ì¹œí™˜ê²½ í™œë™"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ì„¤ëª…</label
                >
                <textarea
                  id="categoryDescription"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"
                  rows="3"
                  required
                  maxlength="200"
                  placeholder="ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                ></textarea>
                <p class="mt-1 text-sm text-gray-500">ìµœëŒ€ 200ì</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ìˆœì„œ</label
                >
                <input
                  type="number"
                  id="categoryOrder"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"
                  min="0"
                  required
                  placeholder="0"
                />
                <p class="mt-1 text-sm text-gray-500">
                  ë‚®ì€ ìˆ«ìê°€ ë¨¼ì € í‘œì‹œë©ë‹ˆë‹¤
                </p>
              </div>
              <div class="flex justify-end space-x-3 pt-4">
                <button
                  type="button"
                  onclick="hideModal()"
                  class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400"
                >
                  ì·¨ì†Œ
                </button>
                <button
                  type="submit"
                  class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500"
                >
                  ì €ì¥
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- íŒ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="tipsSection" class="hidden space-y-6">
          <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-[#2F855A] title-font">
              íŒ ê´€ë¦¬
            </h2>
            <div class="flex space-x-4">
              <select id="tipCategoryFilter" class="rounded-lg border-gray-300">
                <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                <option value="íƒ„ì†Œì¤‘ë¦½">íƒ„ì†Œì¤‘ë¦½</option>
                <option value="ì‹ë¬¼ê´€ë¦¬">ì‹ë¬¼ê´€ë¦¬</option>
              </select>
              <button
                onclick="showAddTipModal()"
                class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
              >
                íŒ ì¶”ê°€
              </button>
            </div>
          </div>

          <div class="bg-white rounded-xl shadow-lg p-6">
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              id="tipsList"
            >
              <!-- íŒ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <!-- íŒ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
        <div
          id="tipModal"
          class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center"
        >
          <div class="bg-white rounded-lg p-8 max-w-2xl w-full">
            <h3 class="text-xl font-bold text-gray-900 mb-4" id="tipModalTitle">
              íŒ ì¶”ê°€
            </h3>
            <form id="tipForm" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ì¹´í…Œê³ ë¦¬</label
                >
                <select
                  id="tipCategory"
                  class="mt-1 block w-full rounded-md border-gray-300"
                  required
                >
                  <option value="íƒ„ì†Œì¤‘ë¦½">íƒ„ì†Œì¤‘ë¦½</option>
                  <option value="ì‹ë¬¼ê´€ë¦¬">ì‹ë¬¼ê´€ë¦¬</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ì œëª©</label
                >
                <input
                  type="text"
                  id="tipTitle"
                  class="mt-1 block w-full rounded-md border-gray-300"
                  required
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ë‚´ìš©</label
                >
                <textarea
                  id="tipContent"
                  class="mt-1 block w-full rounded-md border-gray-300"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ì´ë¯¸ì§€ URL (ì„ íƒì‚¬í•­)</label
                >
                <input
                  type="url"
                  id="tipImageUrl"
                  class="mt-1 block w-full rounded-md border-gray-300"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >ìˆœì„œ</label
                >
                <input
                  type="number"
                  id="tipOrder"
                  class="mt-1 block w-full rounded-md border-gray-300"
                  min="0"
                  required
                />
              </div>
              <div class="flex justify-end space-x-3">
                <button
                  type="button"
                  onclick="hideTipModal()"
                  class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"
                >
                  ì·¨ì†Œ
                </button>
                <button
                  type="submit"
                  class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                >
                  ì €ì¥
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸ ë° ì´ˆê¸° ë°ì´í„° ë¡œë“œ
      document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("accessToken");
        const userRole = localStorage.getItem("userRole");

        if (!token || userRole !== "admin") {
          window.location.href = "login.html";
          return;
        }

        await loadDashboard();
      });

      // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
      async function loadDashboard() {
        try {
          const token = localStorage.getItem("accessToken");
          const response = await fetch(
            "http://127.0.0.1:5500/api/admin/dashboard",
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          const data = await response.json();

          // í†µê³„ ì—…ë°ì´íŠ¸
          const progressBar = document.getElementById("progressBar");
          const progressText = document.getElementById("progressText");

          if (progressBar && progressText) {
            progressBar.style.width = `${data.progress || 0}%`;
            progressText.textContent = `${data.progress || 0}%`;
          }

          // ë‹¤ë¥¸ í†µê³„ ì—…ë°ì´íŠ¸
          document.getElementById("pendingCount").textContent =
            data.pendingActivities || 0;
          document.getElementById("userCount").textContent =
            data.totalUsers || 0;
          document.getElementById("todayActivities").textContent =
            data.todayActivities || 0;

          // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í‘œì‹œ
          const categoryStatsDiv = document.getElementById("categoryStats");
          categoryStatsDiv.innerHTML = "";

          data.categoryStats.forEach((stat) => {
            const div = document.createElement("div");
            div.className = "bg-gray-50 rounded-lg p-4";
            div.innerHTML = `
              <h4 class="font-medium text-gray-900">${stat.name}</h4>
              <dl class="mt-2 grid grid-cols-2 gap-4">
                <div>
                  <dt class="text-sm text-gray-500">ìŠ¹ì¸ë¨</dt>
                  <dd class="text-lg font-medium text-green-600">${stat.approved}</dd>
                </div>
                <div>
                  <dt class="text-sm text-gray-500">ëŒ€ê¸°ì¤‘</dt>
                  <dd class="text-lg font-medium text-yellow-600">${stat.pending}</dd>
                </div>
              </dl>
            `;
            categoryStatsDiv.appendChild(div);
          });
        } catch (err) {
          console.error("ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", err);
        }
      }

      // ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜
      function showSection(sectionId) {
        const sections = [
          "dashboardSection",
          "activitiesSection",
          "usersSection",
          "categoriesSection",
          "tipsSection",
        ];

        sections.forEach((id) => {
          document.getElementById(id).classList.add("hidden");
        });

        document.getElementById(sectionId).classList.remove("hidden");
      }

      // ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById("dashboardBtn").addEventListener("click", () => {
        showSection("dashboardSection");
        loadDashboard();
      });

      // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
      document
        .getElementById("logoutBtn")
        .addEventListener("click", async () => {
          try {
            const token = localStorage.getItem("accessToken");
            const refreshToken = localStorage.getItem("refreshToken");

            await fetch("http://127.0.0.1:5500/api/auth/logout", {
              method: "POST",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ refreshToken }),
            });

            localStorage.removeItem("accessToken");
            localStorage.removeItem("refreshToken");
            localStorage.removeItem("userRole");

            window.location.href = "login.html";
          } catch (err) {
            console.error("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:", err);
            alert("ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        });

      // í™œë™ ì¸ì¦ ê´€ë¦¬ ì„¹ì…˜ ê´€ë ¨ ì½”ë“œ
      document.getElementById("activitiesBtn").addEventListener("click", () => {
        showSection("activitiesSection");
        loadActivities();
      });

      // ì¹´í…Œê³ ë¦¬ í•„í„° ì´ˆê¸°í™”
      async function initializeCategoryFilter() {
        try {
          const response = await fetch("http://127.0.0.1:5500/api/categories", {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
            },
          });
          const categories = await response.json();

          const categoryFilter = document.getElementById("categoryFilter");
          categories.forEach((category) => {
            const option = document.createElement("option");
            option.value = category.code;
            option.textContent = category.name;
            categoryFilter.appendChild(option);
          });
        } catch (err) {
          console.error("ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:", err);
        }
      }

      // í™œë™ ëª©ë¡ ë¡œë“œ
      async function loadActivities(page = 1) {
        try {
          const status = document.getElementById("statusFilter").value;
          const category = document.getElementById("categoryFilter").value;

          const response = await fetch(
            `http://127.0.0.1:5500/api/admin/activities?page=${page}&status=${status}&category=${category}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
              },
            }
          );

          const data = await response.json();
          displayActivities(data);
        } catch (err) {
          console.error("í™œë™ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", err);
        }
      }

      // í™œë™ ëª©ë¡ í‘œì‹œ
      function displayActivities(data) {
        const activitiesList = document.getElementById("activitiesList");
        activitiesList.innerHTML = "";

        data.activities.forEach((activity) => {
          const activityElement = document.createElement("div");
          activityElement.className = "border rounded-lg p-4 space-y-2";
          activityElement.innerHTML = `
            <div class="flex justify-between items-start">
              <div>
                <p class="font-bold">${activity.userId.name} (${
            activity.userId.studentId
          })</p>
                <p class="text-sm text-gray-600">${activity.category}</p>
                <p class="text-sm text-gray-500">${new Date(
                  activity.createdAt
                ).toLocaleString()}</p>
              </div>
              <div class="flex space-x-2">
                ${
                  activity.status === "pending"
                    ? `
                  <button onclick="updateActivityStatus('${activity._id}', 'approved')" 
                          class="px-3 py-1 bg-green-500 text-white rounded-lg">
                    ìŠ¹ì¸
                  </button>
                  <button onclick="updateActivityStatus('${activity._id}', 'rejected')"
                          class="px-3 py-1 bg-red-500 text-white rounded-lg">
                    ê±°ì ˆ
                  </button>
                `
                    : `
                  <span class="px-3 py-1 ${
                    activity.status === "approved"
                      ? "bg-green-100 text-green-800"
                      : "bg-red-100 text-red-800"
                  } rounded-lg">
                    ${activity.status === "approved" ? "ìŠ¹ì¸ë¨" : "ê±°ì ˆë¨"}
                  </span>
                `
                }
              </div>
            </div>
            <div class="mt-2">
              <img src="${
                activity.imageUrl
              }" alt="í™œë™ ì¸ì¦ ì´ë¯¸ì§€" class="w-32 h-32 object-cover rounded-lg">
            </div>
          `;
          activitiesList.appendChild(activityElement);
        });

        // í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ
        displayPagination(data);
      }

      // í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ
      function displayPagination(data) {
        const pagination = document.getElementById("activitiesPagination");
        pagination.innerHTML = "";

        for (let i = 1; i <= data.totalPages; i++) {
          const button = document.createElement("button");
          button.className = `px-3 py-1 rounded-lg ${
            i === data.currentPage
              ? "bg-green-500 text-white"
              : "bg-gray-200 hover:bg-gray-300"
          }`;
          button.textContent = i;
          button.onclick = () => loadActivities(i);
          pagination.appendChild(button);
        }
      }

      // í™œë™ ìƒíƒœ ì—…ë°ì´íŠ¸
      async function updateActivityStatus(activityId, status) {
        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/activities/${activityId}/status`,
            {
              method: "PATCH",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ status }),
            }
          );

          if (response.ok) {
            loadActivities(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            const error = await response.json();
            alert(error.message);
          }
        } catch (err) {
          console.error("í™œë™ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", err);
          alert("í™œë™ ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í•„í„° ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document
        .getElementById("statusFilter")
        .addEventListener("change", () => loadActivities(1));
      document
        .getElementById("categoryFilter")
        .addEventListener("change", () => loadActivities(1));

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´í…Œê³ ë¦¬ í•„í„° ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", () => {
        initializeCategoryFilter();
      });

      // ìš©ì ê´€ë¦¬ ì„¹ì…˜ ê´€ë ¨ ì½”ë“œ
      document.getElementById("usersBtn").addEventListener("click", () => {
        showSection("usersSection");
        loadUsers();
      });

      // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
      async function loadUsers(page = 1) {
        try {
          const searchTerm = document.getElementById("userSearchInput").value;
          const response = await fetch(
            `http://127.0.0.1:5500/api/users?page=${page}&search=${searchTerm}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
              },
            }
          );

          const data = await response.json();
          displayUsers(data);
        } catch (err) {
          console.error("ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", err);
        }
      }

      // ì‚¬ìš©ì ëª©ë¡ í‘œì‹œ
      function displayUsers(data) {
        const usersList = document.getElementById("usersList");
        usersList.innerHTML = "";

        data.users.forEach((user) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
              user.studentId
            }</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
              user.name
            }</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              ${new Date(user.createdAt).toLocaleDateString()}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              ${
                user.role === "admin"
                  ? '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">ê´€ë¦¬ì</span>'
                  : '<span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">ì¼ë°˜</span>'
              }
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
              <button 
                onclick="toggleUserRole('${user._id}', '${
            user.role === "admin" ? "user" : "admin"
          }')"
                class="text-indigo-600 hover:text-indigo-900"
              >
                ${user.role === "admin" ? "ê´€ë¦¬ì í•´ì œ" : "ê´€ë¦¬ì ì§€ì •"}
              </button>
              <button
                onclick="resetUserPassword('${user._id}')"
                class="text-yellow-600 hover:text-yellow-900"
              >
                ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
              </button>
              <button
                onclick="deleteUser('${user._id}')"
                class="text-red-600 hover:text-red-900"
              >
                ì‚­ì œ
              </button>
            </td>
          `;
          usersList.appendChild(row);
        });

        // í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ
        displayUsersPagination(data);
      }

      // ì‚¬ìš©ì í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ
      function displayUsersPagination(data) {
        const pagination = document.getElementById("usersPagination");
        pagination.innerHTML = "";

        for (let i = 1; i <= data.totalPages; i++) {
          const button = document.createElement("button");
          button.className = `px-3 py-1 rounded-lg ${
            i === data.currentPage
              ? "bg-green-500 text-white"
              : "bg-gray-200 hover:bg-gray-300"
          }`;
          button.textContent = i;
          button.onclick = () => loadUsers(i);
          pagination.appendChild(button);
        }
      }

      // ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½
      async function toggleUserRole(userId, newRole) {
        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/users/${userId}/role`,
            {
              method: "PATCH",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ role: newRole }),
            }
          );

          if (response.ok) {
            loadUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            const error = await response.json();
            alert(error.message);
          }
        } catch (err) {
          console.error("ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½ ì‹¤íŒ¨:", err);
          alert("ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ê²€ìƒ‰ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë””ë°”ìš´ìŠ¤ ì ìš©)
      let searchTimeout;
      document
        .getElementById("userSearchInput")
        .addEventListener("input", (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => loadUsers(1), 300);
        });

      // ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ ê´€ë ¨ ì½”ë“œ
      document.getElementById("categoriesBtn").addEventListener("click", () => {
        showSection("categoriesSection");
        loadCategories();
      });

      // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ
      async function loadCategories() {
        try {
          const response = await fetch(
            "http://127.0.0.1:5500/api/categories/all",
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
              },
            }
          );

          const categories = await response.json();
          displayCategories(categories);
        } catch (err) {
          console.error("ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", err);
        }
      }

      // ì¹´í…Œê³ ë¦¬ ëª©ë¡ í‘œì‹œ
      function displayCategories(categories) {
        const categoriesList = document.getElementById("categoriesList");
        categoriesList.innerHTML = "";

        categories.forEach((category) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
              category.code
            }</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
              category.name
            }</td>
            <td class="px-6 py-4 text-sm text-gray-500">${
              category.description
            }</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
              category.order
            }</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                category.isActive
                  ? "bg-green-100 text-green-800"
                  : "bg-red-100 text-red-800"
              }">
                ${category.isActive ? "í™œì„±" : "ë¹„í™œì„±"}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
              <button
                onclick="toggleCategoryStatus('${
                  category.code
                }', ${!category.isActive})"
                class="text-${
                  category.isActive ? "red" : "green"
                }-600 hover:text-${category.isActive ? "red" : "green"}-900"
              >
                ${category.isActive ? "ë¹„í™œì„±í™”" : "í™œì„±í™”"}
              </button>
              <button
                onclick="deleteCategory('${category.code}')"
                class="text-red-600 hover:text-red-900"
              >
                ì‚­ì œ
              </button>
            </td>
          `;
          categoriesList.appendChild(row);
        });
      }

      // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
      function showAddCategoryModal() {
        document.getElementById("modalTitle").textContent = "ì¹´í…Œê³ ë¦¬ ì¶”ê°€";
        document.getElementById("categoryForm").reset();
        document.getElementById("categoryCode").disabled = false;
        document.getElementById("categoryModal").classList.remove("hidden");
        document.getElementById("categoryModal").classList.add("flex");
      }

      function hideModal() {
        document.getElementById("categoryModal").classList.add("hidden");
        document.getElementById("categoryModal").classList.remove("flex");
      }

      // ì¹´í…Œê³ ë¦¬ í¼ ì œì¶œ ì²˜ë¦¬
      document
        .getElementById("categoryForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          try {
            const formData = {
              code: document.getElementById("categoryCode").value.trim(),
              name: document.getElementById("categoryName").value.trim(),
              description: document
                .getElementById("categoryDescription")
                .value.trim(),
              order:
                parseInt(document.getElementById("categoryOrder").value) || 0,
            };

            // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
            if (!formData.code || !formData.name || !formData.description) {
              alert("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
            }

            // ì½”ë“œ í˜•ì‹ ê²€ì‚¬
            if (!/^[a-zA-Z0-9_-]+$/.test(formData.code)) {
              alert(
                "ì¹´í…Œê³ ë¦¬ ì½”ë“œëŠ” ì˜ë¬¸, ìˆ«ì, í•˜ì´í”ˆ(-), ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              );
              return;
            }

            const response = await fetch(
              "http://127.0.0.1:5500/api/categories",
              {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${localStorage.getItem(
                    "accessToken"
                  )}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              }
            );

            const data = await response.json();

            if (!response.ok) {
              throw new Error(
                data.message || "ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
              );
            }

            alert("ì¹´í…Œê³ ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
            hideModal();
            loadCategories(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } catch (err) {
            console.error("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨:", err);
            alert(err.message);
          }
        });

      // ì¹´í…Œê³ ë¦¬ ìƒíƒœ í† ê¸€
      async function toggleCategoryStatus(code, isActive) {
        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/categories/${code}`,
            {
              method: "PUT",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ isActive }),
            }
          );

          if (response.ok) {
            loadCategories();
          } else {
            const error = await response.json();
            alert(error.message);
          }
        } catch (err) {
          console.error("ì¹´í…Œê³ ë¦¬ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:", err);
          alert("ì¹´í…Œê³ ë¦¬ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // íŒ ê´€ë¦¬ ì„¹ì…˜ ê´€ë ¨ ì½”ë“œ
      document.getElementById("tipsBtn").addEventListener("click", () => {
        showSection("tipsSection");
        loadTips();
      });

      // íŒ ëª©ë¡ ë¡œë“œ
      async function loadTips() {
        try {
          const category = document.getElementById("tipCategoryFilter").value;
          const url = category
            ? `http://127.0.0.1:5500/api/tips?category=${category}`
            : "http://127.0.0.1:5500/api/tips";

          const response = await fetch(url, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
            },
          });

          const tips = await response.json();
          displayTips(tips);
        } catch (err) {
          console.error("íŒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", err);
        }
      }

      // íŒ ëª©ë¡ í‘œì‹œ
      function displayTips(tips) {
        const tipsList = document.getElementById("tipsList");
        tipsList.innerHTML = "";

        tips.forEach((tip) => {
          const card = document.createElement("div");
          card.className =
            "bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden";
          card.innerHTML = `
            <div class="p-4">
              <div class="flex justify-between items-start">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                  ${tip.category}
                </span>
                <div class="flex space-x-2">
                  <button
                    onclick="deleteTip('${tip._id}')"
                    class="text-red-600 hover:text-red-900"
                  >
                    ì‚­ì œ
                  </button>
                </div>
              </div>
              <h3 class="mt-2 text-lg font-semibold text-gray-900">${
                tip.title
              }</h3>
              <p class="mt-2 text-sm text-gray-600">${tip.content}</p>
              ${
                tip.imageUrl
                  ? `
                <img src="${tip.imageUrl}" alt="${tip.title}" class="mt-2 w-full h-40 object-cover rounded">
              `
                  : ""
              }
              <div class="mt-2 text-sm text-gray-500">ìˆœì„œ: ${tip.order}</div>
            </div>
          `;
          tipsList.appendChild(card);
        });
      }

      // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
      function showAddTipModal() {
        document.getElementById("tipModalTitle").textContent = "íŒ ì¶”ê°€";
        document.getElementById("tipForm").reset();
        document.getElementById("tipModal").classList.remove("hidden");
        document.getElementById("tipModal").classList.add("flex");
      }

      function hideTipModal() {
        document.getElementById("tipModal").classList.add("hidden");
        document.getElementById("tipModal").classList.remove("flex");
      }

      // íŒ í¼ ì œì¶œ ì²˜ë¦¬
      document
        .getElementById("tipForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = {
            category: document.getElementById("tipCategory").value,
            title: document.getElementById("tipTitle").value,
            content: document.getElementById("tipContent").value,
            imageUrl: document.getElementById("tipImageUrl").value,
            order: parseInt(document.getElementById("tipOrder").value),
          };

          try {
            const response = await fetch("http://127.0.0.1:5500/api/tips", {
              method: "POST",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            if (response.ok) {
              hideTipModal();
              loadTips();
            } else {
              const error = await response.json();
              alert(error.message);
            }
          } catch (err) {
            console.error("íŒ ì €ì¥ ì‹¤íŒ¨:", err);
            alert("íŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        });

      // íŒ ì‚­ì œ
      async function deleteTip(tipId) {
        if (!confirm("ì •ë§ ì´ íŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/tips/${tipId}`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
              },
            }
          );

          if (response.ok) {
            loadTips();
          } else {
            const error = await response.json();
            alert(error.message);
          }
        } catch (err) {
          console.error("íŒ ì‚­ì œ ì‹¤íŒ¨:", err);
          alert("íŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì¹´í…Œê³ ë¦¬ í•„í„° ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document
        .getElementById("tipCategoryFilter")
        .addEventListener("change", loadTips);

      // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” í•¨ìˆ˜
      async function resetUserPassword(userId) {
        if (!confirm("í•´ë‹¹ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/users/${userId}/reset-password`,
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
                "Content-Type": "application/json",
              },
            }
          );

          const data = await response.json();
          if (response.ok) {
            alert(
              `ì´ˆê¸°í™”ëœ ë¹„ë°€ë²ˆí˜¸: ${data.temporaryPassword}\nì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•´ì£¼ì„¸ìš”.`
            );
          } else {
            alert(data.message);
          }
        } catch (err) {
          console.error("ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì‹¤íŒ¨:", err);
          alert("ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì‚¬ìš©ì ì‚­ì œ í•¨ìˆ˜
      async function deleteUser(userId) {
        if (
          !confirm(
            "ì •ë§ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          )
        )
          return;

        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/users/${userId}`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
              },
            }
          );

          if (response.ok) {
            loadUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            const error = await response.json();
            alert(error.message);
          }
        } catch (err) {
          console.error("ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨:", err);
          alert("ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì¹´í…Œê³ ë¦¬ ì‚­ì œ í•¨ìˆ˜ ì¶”ê°€
      async function deleteCategory(code) {
        if (
          !confirm(
            "ì •ë§ ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          )
        ) {
          return;
        }

        try {
          const response = await fetch(
            `http://127.0.0.1:5500/api/categories/${code}`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${localStorage.getItem("accessToken")}`,
              },
            }
          );

          const data = await response.json();

          if (response.ok) {
            alert("ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadCategories(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            alert(data.message);
          }
        } catch (err) {
          console.error("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨:", err);
          alert("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }
    </script>
  </body>
</html>
